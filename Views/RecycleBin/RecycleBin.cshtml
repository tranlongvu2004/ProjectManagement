@model List<PorjectManagement.ViewModels.RecyclebinVM>
<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
<style>
    /* ===============================
       TRASH PAGE – THEME AWARE
    ================================ */

    .trash-page {
        background: var(--bg-color);
        color: var(--text-color);
        padding: 30px;
        min-height: 100vh;
        font-family: Inter, sans-serif;
    }

    .subtitle {
        color: var(--muted-text);
    }

    /* Toolbar */
    .toolbar {
        display: flex;
        gap: 12px;
        margin-bottom: 15px;
    }

    .search-box {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        padding: 8px 12px;
        border-radius: 6px;
        width: 240px;
    }

        .search-box::placeholder {
            color: var(--muted-text);
        }

    .filter-btn {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        padding: 8px 14px;
        border-radius: 6px;
    }

        .filter-btn:hover {
            background: var(--hover-bg);
        }

    /* Table */
    .trash-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--card-bg);
        border-radius: 8px;
        border: 1px solid var(--border-color);
    }

        .trash-table th,
        .trash-table td {
            padding: 14px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .trash-table th {
            background: var(--hover-bg);
            color: var(--text-color);
            font-weight: 600;
        }

        .trash-table tr:hover {
            background: var(--hover-bg);
        }

    /* Action */
    .btn-ellipsis {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        width: 32px;
        height: 32px;
        border-radius: 6px;
    }

        .btn-ellipsis:hover {
            background: var(--hover-bg);
        }

    /* Dropdown */
    .dropdown-menu {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }

    .dropdown-item {
        color: var(--text-color);
    }

        .dropdown-item:hover {
            background: var(--hover-bg);
        }
</style>

<div class="trash-page">
    @{
        var projectId = Model.FirstOrDefault()?.ProjectId;
    }

    <h2>Trash</h2>
    <p class="subtitle">
        This is your account trash. Items will be permanently deleted after 30 days.
    </p>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <button type="button"
                class="btn btn-outline-secondary"
                onclick="history.back()">
            <i class="bi bi-arrow-left"></i> Back
        </button>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
        <input type="text" placeholder="Search..." class="search-box" id="searchInput" />

        <select class="filter-btn" id="typeFilter">
            <option value="">All types</option>
            <option value="Task">Task</option>
            <option value="Resource">Resource</option>
        </select>

        <select class="filter-btn" id="sortDate">
            <option value="desc">Newest first</option>
            <option value="asc">Oldest first</option>
        </select>
    </div>


    <!-- Table -->
    <table class="trash-table">
        <thead>
            <tr>
                <th><input type="checkbox" /></th>
                <th>Name</th>
                <th>Type</th>
                <th>Deleted by</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {

                <tr class="trash-row"
                    data-name="@item.Name.ToLower()"
                    data-type="@item.EntityType"
                    data-date="@item.DeletedAt.Ticks">

                    <td><input type="checkbox" /></td>
                    <td>@item.Name</td>
                    <td>@item.EntityType</td>
                    <td>@item.DeletedBy</td>
                    <td>@(DateTime.Now.Day - item.DeletedAt.Day) day(s) ago</td>
                    <td class="action-cell">
                        <div class="dropdown">
                            <button class="btn btn-ellipsis" type="button">
                                ⋯
                            </button>

                            <div class="dropdown-menu">

                                <button class="dropdown-item restore-btn"
                                        data-recycle-id="@item.RecycleId">
                                    ♻ Restore
                                </button>

                                <button class="dropdown-item delete-permanent-btn text-danger"
                                        data-recycle-id="@item.RecycleId">
                                    🗑 Delete permanently
                                </button>
                            </div>
                        </div>
                    </td>


                </tr>
            }

        </tbody>
    </table>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {

        // Toggle dropdown
        document.querySelectorAll('.btn-ellipsis').forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.stopPropagation();
                document.querySelectorAll('.dropdown-menu').forEach(m => m.style.display = 'none');
                this.nextElementSibling.style.display = 'block';
            });
        });

        document.addEventListener('click', function () {
            document.querySelectorAll('.dropdown-menu').forEach(m => m.style.display = 'none');
        });

        // Restore
        document.querySelectorAll('.restore-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const selectedRecycleId = this.dataset.recycleId;
                fetch('/RecycleBin/Restore', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ recycleId: selectedRecycleId })
        })
        .then(res => {
            if (res.ok) {
                location.reload();
            } else {
                alert('Restore failed');
            }
        });
            });
        });
        // Delete permanently
        document.querySelectorAll('.delete-permanent-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const selectedRecycleId = this.dataset.recycleId;
                fetch('/RecycleBin/DeletePermanent', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ recycleId: selectedRecycleId })
        })
        .then(res => {
            if (res.ok) {
                location.reload();
            } else {
                alert('Delete failed');
            }
        });
            });
        });

    });
</script>
<script>
    const searchInput = document.getElementById('searchInput');
    const typeFilter = document.getElementById('typeFilter');
    const sortDate = document.getElementById('sortDate');
    const rows = Array.from(document.querySelectorAll('.trash-row'));
    const tbody = document.querySelector('.trash-table tbody');

    function applyFilters() {
        const keyword = searchInput.value.toLowerCase();
        const type = typeFilter.value;

        rows.forEach(row => {
            const matchName = row.dataset.name.includes(keyword);
            const matchType = !type || row.dataset.type === type;
            row.style.display = (matchName && matchType) ? '' : 'none';
        });

        sortRows();
    }

    function sortRows() {
        const order = sortDate.value;

        const visibleRows = rows.filter(r => r.style.display !== 'none');

        visibleRows.sort((a, b) => {
            const dateA = parseInt(a.dataset.date);
            const dateB = parseInt(b.dataset.date);
            return order === 'asc' ? dateA - dateB : dateB - dateA;
        });

        visibleRows.forEach(row => tbody.appendChild(row));
    }

    searchInput.addEventListener('input', applyFilters);
    typeFilter.addEventListener('change', applyFilters);
    sortDate.addEventListener('change', sortRows);
</script>

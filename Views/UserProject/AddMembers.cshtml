@model PorjectManagement.ViewModels.AddMembersViewModel
@{
    ViewData["Title"] = "Add Members";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
    .card {
        border: none;
        border-radius: 18px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        overflow: hidden;
    }

    table thead {
        background: #f3f6fb;
        font-weight: 600;
        font-size: 14px;
    }

        table thead th {
            padding: 14px 18px;
            color: #4a4f5c;
            border-bottom: 1px solid #e2e6ef;
        }

    .user-row:hover {
        background: #eef4ff !important;
    }

    .user-check,
    #selectAll {
        transform: scale(1.25);
        cursor: pointer;
    }

    .rounded-circle {
        background: linear-gradient(135deg, #5673ff, #3a56ff);
        color: #fff;
        font-weight: 600;
        font-size: 15px;
        width: 38px;
        height: 38px;
    }

    .fw-bold {
        font-size: 15px;
        color: #222;
    }

    .badge {
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 14px;
        font-weight: 600;
    }

        .badge.bg-primary {
            background-color: #e1e7ff !important;
            color: #3955ff !important;
        }

        .badge.bg-warning.text-dark {
            background-color: #ffe9b6 !important;
            color: #7a5a00 !important;
        }

        .badge.bg-secondary {
            background-color: #ececec !important;
            color: #555 !important;
        }

    #searchBox {
        border-radius: 12px;
        padding: 10px 14px;
        width: 360px;
        border: 1px solid #d4dae5;
    }

    button.btn-primary {
        background: #3d6bff;
        border: none;
        padding: 11px 22px;
        font-size: 15px;
        border-radius: 12px;
        font-weight: 600;
    }

    /* ===== CÂN CỘT SAU KHI BỎ STATUS ===== */
    .col-check {
        width: 48px;
        text-align: center;
    }

    .col-name {
        width: 28%;
    }

    .col-email {
        width: 32%;
    }

    .col-start {
        width: 14%;
        white-space: nowrap;
    }

    .col-role {
        width: 16%;
        text-align: center;
    }
</style>

<div class="container my-4">
    <h3 class="mb-3">
        Add members to project:
        <span class="text-primary">@Model.ProjectName</span>
    </h3>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <input id="searchBox" class="form-control" type="search"
               placeholder="Search by intern's name" />
    </div>

    <form id="addForm" asp-controller="UserProject" asp-action="AddMembers" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="ProjectId" />

        <div class="card">
            <div class="card-body p-0">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th class="col-check">
                                <input id="selectAll" type="checkbox" />
                            </th>
                            <th class="col-name">Intern Name</th>
                            <th class="col-email">Gmail</th>
                            <th class="col-start">Start Day</th>
                            <th class="col-role">Role</th>
                        </tr>
                    </thead>

                    <tbody id="usersTableBody">
                        @for (int i = 0; i < Model.Users.Count; i++)
                        {
                            var u = Model.Users[i];
                            <tr class="user-row" data-name="@u.FullName.ToLower()">
                                <td class="col-check">
                                    <input class="form-check-input user-check"
                                           name="SelectedUserIds"
                                           type="checkbox"
                                           value="@u.UserId" />
                                </td>

                                <td class="col-name">
                                    <div class="d-flex align-items-center">
                                        <div class="rounded-circle me-2 d-flex align-items-center justify-content-center">
                                            @u.FullName.Split(' ').Last().Substring(0, 1).ToUpper()
                                        </div>
                                        <div class="fw-bold">@u.FullName</div>
                                    </div>
                                </td>

                                <td class="col-email">@u.Email</td>

                                <td class="col-start">
                                    @(u.CreatedAt.HasValue
                                                                    ? u.CreatedAt.Value.ToString("dd/MM/yyyy")
                                                                    : "")
                                                                     </td>

                                <td class="col-role">
                                    <span class="badge
                                            @(u.RoleName == "Mentor" ? "bg-primary" :
                                                                                    u.RoleName == "InternLead" ? "bg-warning text-dark" :
                                                                                    "bg-secondary")">
                                    @u.RoleName
                                </span>
                            </td>
                        </tr>
                                                }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-3">
            <span id="selectedCount">0 interns selected</span>

            <div>
                <a asp-controller="Home" asp-action="Index"
                   class="btn btn-outline-secondary me-2">Cancel</a>
                <button type="submit" class="btn btn-primary">
                    Add (<span id="addCount">0</span>)
                </button>
            </div>
        </div>
    </form>
</div>

<script>
    (function () {
        const selectAll = document.getElementById('selectAll');
        const checks = document.querySelectorAll('.user-check');
        const selectedCountSpan = document.getElementById('selectedCount');
        const addCountSpan = document.getElementById('addCount');
        const searchBox = document.getElementById('searchBox');

        function updateCounts() {
            const checked = document.querySelectorAll('.user-check:checked').length;
            selectedCountSpan.textContent = `${checked} intern chosen`;
            addCountSpan.textContent = checked;
        }

        selectAll.addEventListener('change', () => {
            checks.forEach(c => c.checked = selectAll.checked);
            updateCounts();
        });

        checks.forEach(c => c.addEventListener('change', () => {
            selectAll.checked = [...checks].every(x => x.checked);
            updateCounts();
        }));

        searchBox.addEventListener('input', function () {
            const q = this.value.toLowerCase();
            document.querySelectorAll('.user-row').forEach(r => {
                r.style.display = r.dataset.name.includes(q) ? '' : 'none';
            });
            updateCounts();
        });

        updateCounts();
    })();
</script>
